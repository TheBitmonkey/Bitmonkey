/**
 * Copyright 2019 Yours Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is furnished
 * to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
 * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */var moneyButton=function(a){"use strict";function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function d(a,b,d){return b&&c(a.prototype,b),d&&c(a,d),a}function e(a){return f(a)||g(a)||h()}function f(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function g(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(a){switch(a.arrayFormat){case"index":return function(b,c,d){return null===c?[j(b,a),"[",d,"]"].join(""):[j(b,a),"[",j(d,a),"]=",j(c,a)].join("")};case"bracket":return function(b,c){return null===c?[j(b,a),"[]"].join(""):[j(b,a),"[]=",j(c,a)].join("")};default:return function(b,c){return null===c?j(b,a):[j(b,a),"=",j(c,a)].join("")};}}function j(a,b){return b.encode?b.strict?z(a):encodeURIComponent(a):a}function k(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function l(a){for(var b=1;b<arguments.length;b++){var c=null==arguments[b]?{}:arguments[b],d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){k(a,b,c[b])})}return a}function m(){H&&(H.parentNode.removeChild(H),H=null)}function n(a){var b=a.title,c=a.message,d=a.buttonText,e=a.buttonUrl,f=a.buttonText2,g=a.buttonUrl2;m(),H=document.createElement("div"),H.setAttribute("style","display: flex; justify-content: center; font-family: sans-serif;");var h=document.getElementsByClassName("popup__moneybutton").item(0);null===h&&(h=x(),document.body.appendChild(h)),h.appendChild(H),H.innerHTML="\n    <div class=\"close__moneybutton\"></div>\n    <div class=\"hint__moneybutton\">\n      <div class=\"content__moneybutton\">\n        <span class=\"title__moneybutton\">".concat(b,"</span>\n        <span class=\"text__moneybutton\">").concat(c,"</span>\n        <div class=\"buttonsWrapper__moneybutton\">\n          ").concat(d?"<a href=\"".concat(e,"\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"button__moneybutton red__moneybutton\">").concat(d,"</a>"):"","\n          ").concat(f?"<a href=\"".concat(g,"\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"button__moneybutton nofill__moneybutton\">").concat(f,"</a>"):"","\n        </div>\n      </div>\n      <style>\n        .hint__moneybutton .button__moneybutton,\n        .hint__moneybutton .title__moneybutton{\n          font-weight:700\n        }\n        .hint__moneybutton .button__moneybutton,\n        .hint__moneybutton .content__moneybutton{\n            color:#fff;\n            box-sizing:border-box;\n            display:flex;\n            font-family: 'IBM Plex Sans', sans-serif;\n        }\n        .hint__moneybutton a{\n            text-decoration:none;\n        }\n        .hint__moneybutton{\n            min-width:254px;\n            position:fixed;\n            bottom: 10px;\n            right: 10px;\n            max-width: 300px;\n            z-index: 1000;\n        }\n        .hint__moneybutton .content__moneybutton{\n          top:0;\n          left:0;\n          right:0;\n          bottom:0;\n          z-index:1\n        }\n        .hint__moneybutton .content__moneybutton{\n            background-color:#191927;\n            padding:30px;\n            border-radius:10px;\n            bottom:19px;\n            left:0;\n            right:0;\n            flex-direction:column;\n            align-content:center;\n            align-items:flex-start;\n            min-width: 260px;\n        }\n        .hint__moneybutton .title__moneybutton{\n            font-size:20px;\n            margin-bottom:10px\n        }\n        .hint__moneybutton .text__moneybutton{\n            font-size:14px;\n            margin-bottom:20px\n        }\n        .hint__moneybutton .buttonsWrapper__moneybutton{\n            width:100%;\n            display:flex;\n            justify-content:space-between;\n            position:relative;\n            z-index:2\n        }\n        .hint__moneybutton .button__moneybutton{\n            text-align:center;\n            font-size:12px;\n            width:calc(50% - 10px);\n            height:35px;\n            padding:0 10px;\n            border-radius:20px;\n            align-items:center;\n            justify-content:center;\n            transition:all 250ms ease-out;\n            cursor:pointer\n        }\n        .hint__moneybutton .button__moneybutton.add__moneybutton {\n            width: auto;\n        }\n        .hint__moneybutton .button__moneybutton.red__moneybutton{\n            background-color:#e54d3f\n        }\n        .hint__moneybutton .button__moneybutton.red__moneybutton:hover{\n            background-color:#ce4134\n        }\n        .hint__moneybutton .button__moneybutton.nofill__moneybutton{\n            border:1px solid #fff\n        }\n        .hint__moneybutton .button__moneybutton.nofill__moneybutton:hover{\n            color:#191927;\n            background-color:#fff\n        }\n        .close__moneybutton {\n          background-color: rgba(255, 255, 255, 0.6);\n          position: fixed;\n          top: 0;\n          left: 0;\n          width: 100vw;\n          height: 100vh;\n          z-index: 999;\n        }\n        @import url('https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,700');\n      </style>\n    </div>\n  ");var i=document.getElementsByClassName("close__moneybutton").item(0);i.addEventListener("click",m)}function o(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};I.has(a)?q(a,b):p(a,b)}function p(a,b){r(a,b);var c=t(b);a.appendChild(c),a.style.position="relative",a.style.display="inline-block",a.style.width="280px",a.style.height="50px",c.contentWindow.onunload=function(){(null===c.contentWindow||c.contentWindow.location.href===u())&&(I.delete(a),a.innerHTML="")};var d=new F(c.contentWindow);d.send("initial-attributes",s(b),{}),d.subscribe("ready",function(){return d.enableDeliver()}),d.subscribe("payment-success",function(a){return v(a,b)}),d.subscribe("error.insufficient-balance",function(a){return w(a,b)}),d.subscribe("error.unexpected-error",function(a){return w(a,b)}),d.subscribe("error.not-logged-in",function(a){return w(a,b)}),d.subscribe("error.compatibility",function(a){return w(a,b)}),d.subscribe("error.safari-compatibility",function(a){return w(a,b)}),d.subscribe("error.too-long-mempool-chain",function(a){return w(a,b)}),d.start(),I.set(a,d)}function q(a,b){var c=I.get(a);c.send("attributes-updated",s(b)),c.subscribe("payment-success",function(a){return v(a,b)}),c.subscribe("error.insufficient-balance",function(a){return w(a,b)}),c.subscribe("error.unexpected-error",function(a){return w(a,b)}),c.subscribe("error.not-logged-in",function(a){return w(a,b)}),c.subscribe("error.compatibility",function(a){return w(a,b)}),c.subscribe("error.safari-compatibility",function(a){return w(a,b)}),c.subscribe("error.too-long-mempool-chain",function(a){return w(a,b)})}function r(a,b){if(!(a instanceof Element))throw new Error("The first argument must be of type Element.");if(!(a instanceof Object)||0===Object.keys(b).length)throw new Error("Please, specify the button's attributes.");if(void 0!==b.buttonData&&"string"!=typeof b.buttonData)throw new Error("\"buttonData\" should be a string.")}function s(a){return{to:a.to,amt:a.amount,edt:a.editable,ccy:a.currency,lbl:a.label,scsmsg:a.successMessage,opd:a.opReturn,os:JSON.stringify(a.outputs),cid:a.clientIdentifier,bid:a.buttonId,bdt:a.buttonData,t:a.type,dev:a.devMode,dsbd:a.disabled}}function t(){var a=document.createElement("iframe");return a.style.border="none",a.style.width="280px",a.style.height="50px",a.scrolling="no",a.src=u(),a}function u(){return"".concat("https://www.moneybutton.com","/iframe/v2?").concat(A({format:"postmessage"}))}function v(a,b){var c=a.payment;c&&"function"==typeof b.onPayment&&b.onPayment.call(window,c)}function w(a,b){var c=a.error,d=a.popup;d&&n(d),c&&"function"==typeof b.onError&&b.onError.call(window,new Error(c))}function x(){var a=document.createElement("div");return a.className="popup__moneybutton",a.style.position="relative",a.style.display="flex",a.style.justifyContent="center",a}function y(a){var b={};for(var c in a){var d=a[c];if(!G.includes(c)){console.warn("Unexpected data attribute: ".concat(c,"."));continue}switch(c){case"outputs":var e=void 0;try{e=JSON.parse(d)}catch(a){e=null}e instanceof Array?b[c]=e:console.warn("The value provided for ".concat(c," is not a valid JSON array."));break;case"devMode":b[c]="true"===d;break;case"onPayment":case"onError":"function"==typeof window[d]?b[c]=window[d]:console.warn("The value provided for ".concat(c," is not a function in the global scope."));break;default:b[c]=d;}}return b}var z=function(a){return encodeURIComponent(a).replace(/[!'()*]/g,function(a){return"%".concat(a.charCodeAt(0).toString(16).toUpperCase())})},A=function(a,b){b=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},b),!1===b.sort&&(b.sort=function(){});var c=i(b);return a?Object.keys(a).sort(b.sort).map(function(d){var e=a[d];if(void 0===e)return"";if(null===e)return j(d,b);if(Array.isArray(e)){var f=[],g=!0,h=!1,i=void 0;try{for(var k,l,m=e.slice()[Symbol.iterator]();!(g=(k=m.next()).done);g=!0)(l=k.value,void 0!==l)&&f.push(c(d,l,f.length))}catch(a){h=!0,i=a}finally{try{g||null==m.return||m.return()}finally{if(h)throw i}}return f.join("&")}return j(d,b)+"="+j(e,b)}).filter(function(a){return 0<a.length}).join("&"):""},B=function(){function a(c){b(this,a),this.keyDefined=function(a){return a in c},this.getValue=function(a){return c[a]}}return d(a,[{key:"get",value:function(a){if(this.keyDefined(a))return this.getValue(a);throw new Error("Unknown configuration: ".concat(a))}}]),a}(),C=function(){function a(){b(this,a),this.variables={}}return d(a,[{key:"build",value:function(){return new B(this.variables)}},{key:"addValue",value:function(a,b){if(void 0===b)throw new Error("Failed to add \"".concat(a,"\" property. The value cannot be undefined"));if(a in this.variables)throw new Error("\"".concat(a,"\" already has a value defined."));return this.variables[a]=b,this}},{key:"addValueWithDefault",value:function(a,b,c){if(void 0===c)throw new Error("Failed to add \"".concat(a,"\" property. Default value cannot be undefined"));return this.addValue(a,void 0===b?c:b)}}]),a}(),D=new C().addValue("NETWORK","mainnet").addValue("MONEY_BUTTON_WEBAPP_PROXY_URI","https://www.moneybutton.com").addValue("MONEY_BUTTON_PUBLIC_CLIENT_IDENTIFIER","a65023353f4a69a96a959fe5f909749c").addValue("MONEY_BUTTON_CONFIDENTIAL_CLIENT_IDENTIFIER","1a9de492bad29c1313da6fbb41bb38e3").addValue("MONEY_BUTTON_CONFIDENTIAL_CLIENT_SECRET","2e39670a5a0fe7e44375e7b6255fd16f").build(),E=D.get("MONEY_BUTTON_WEBAPP_PROXY_URI"),F=function a(c){var d=this;b(this,a),k(this,"start",function(){window.addEventListener("message",d._onMessageReceived,!1)}),k(this,"enableDeliver",function(){d._deliverMessages=!0,d._pendingMessages.forEach(function(a){return d.send(a.topic,a.payload,a.extraPayload)}),d._pendingMessages=[]}),k(this,"finalize",function(){window.removeEventListener("message",d._onMessageReceived,!1)}),k(this,"subscribe",function(a,b){d.handlers[a]=b}),k(this,"_onMessageReceived",function(a){if(a.source===d.targetWindow&&a.data&&a.data.v1){var b=a.data.v1,c=d.handlers[b.topic];c&&c(b.payload,b.topic)}}),k(this,"send",function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!d._deliverMessages)d._pendingMessages=[].concat(e(d._pendingMessages),[{topic:a,payload:b,extraPayload:c}]);else{d.targetWindow.postMessage(l({},{v1:{topic:a,payload:b}},c),"*")}}),k(this,"sendInsufficientBalanceError",function(){var a={error:"insufficient balance",popup:{title:"Low Balance",message:"Your balance is too low to make this payment.",buttonText:"Add Money",buttonUrl:"".concat(E,"/money")}};d.send("error.insufficient-balance",a,a)}),k(this,"sendUnexpectedError",function(a){var b={error:"unexpected error",popup:{title:"Unexpected Error",message:a.message}};d.send("error.unexpected-error",b,b)}),k(this,"sendPaymentSuccess",function(a){var b={payment:a};d.send("payment-success",b,b)}),k(this,"sendNotLoggedInError",function(){var a={error:"not logged in",popup:{title:"Money Button",message:"We believe in sound digital money for everyone in the world. Join Money Button to make this payment.",buttonText:"Sign Up",buttonUrl:"".concat(E,"/register"),buttonText2:"Log In",buttonUrl2:"".concat(E,"/login")}};d.send("error.not-logged-in",a,a)}),k(this,"sendCompatibilityIssue",function(a){var b={error:"compatibility",message:a.message,popup:{title:"Compatibility",message:a.message}};d.send("error.compatibility",b,b)}),k(this,"sendSafaryIssueHint",function(){var a={error:"safari privacy",popup:{title:"Money Button",message:"We believe in sound digital money for everyone in the world. Enable Money Button on Safari and log in to make this payment.",buttonUrl:"https://blog.moneybutton.com/2018/09/24/how-to-enable-money-button-on-safari-and-ios/",buttonText:"Enable"}};d.send("error.safari-compatibility",a,a)}),this.handlers={},this.targetWindow=c,this._pendingMessages=[],this._deliverMessages=!1},G=["to","amount","currency","label","successMessage","opReturn","outputs","clientIdentifier","buttonId","buttonData","type","onPayment","onError","devMode","editable","disabled"],H=null,I=new Map;return document.addEventListener("DOMContentLoaded",function(){if(!window.moneyButton.alreadyLoaded){window.moneyButton.alreadyLoaded=!0;var a=x();document.body.appendChild(a);for(var b,c=document.getElementsByClassName("money-button"),d=0;d<c.length;++d){b=c.item(d);try{var e=y(b.dataset);0<Object.keys(e).length&&o(b,e),console.log("Money Button: added button.")}catch(a){console.error("Money Button: adding button failed.",a)}}}}),a.render=o,a}({});
//# sourceMappingURL=moneybutton.js.map
